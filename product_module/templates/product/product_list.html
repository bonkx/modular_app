{% extends 'base.html' %}

{% block title %}Product List{% endblock title %}

{% block content %}
<h2>Product List</h2>
{% if perms.product_module.add_product %}
<a href="{% url 'product_add' %}" class="btn btn-success mb-3">Add Product</a>
{% endif %}

<table class="table table-bordered table-striped align-middle">
    <tr>
        <th>Name</th>
        <th>Barcode</th>
        <th>Price</th>
        <th>Stock</th>
        {% if user.is_authenticated %}
        <th>Action</th>
        {% endif %}
    </tr>
    {% for product in object_list %}
    <tr>
        <td>{{ product.name }}</td>
        <td>{{ product.barcode }}</td>
        <td>{{ product.price }}</td>
        <td>{{ product.stock }}</td>
        {% if user.is_authenticated %}
        <td>
            {% if perms.product_module.change_product %}
            <a href="{% url 'product_edit' product.pk %}" class="btn btn-warning btn-sm">Edit</a>
            {% endif %}
            {% if perms.product_module.delete_product %}
            <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal"
                data-delete-url="{% url 'product_delete' product.id %}">
                Delete
            </button>
            {% endif %}
        </td>
        {% endif %}
    </tr>
    {% empty %}
    <tr>
        <td colspan="100%" class="text-center text-muted">No product found.</td>
    </tr>
    {% endfor %}
</table>


<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure to delete this data?
            </div>
            <div class="modal-footer">
                <form id="deleteForm" method="post" action="">
                    {% csrf_token %}
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Yes, Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}


{% block js %}
<script>
    const deleteModal = document.getElementById('deleteModal')
    deleteModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget
        const deleteUrl = button.getAttribute('data-delete-url')
        const form = document.getElementById('deleteForm')
        form.action = deleteUrl
    })
</script>
{% endblock js %}